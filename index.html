<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neon Dodge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body { margin:0; padding:0; background:radial-gradient(circle at top,#0f2027,#000); color:#fff; font-family:system-ui,sans-serif; overflow:hidden; touch-action:none; }
    canvas{display:block;position:fixed;inset:0;z-index:0}
    #ui{position:fixed;top:16px;left:16px;font-size:14px;opacity:.9;z-index:10}
    #dashUI{position:fixed;bottom:160px;right:50px;width:60px;height:8px;background:rgba(255,255,255,.2);border-radius:4px;overflow:hidden}
    #dashFill{height:100%;width:100%;background:#ff00cc}
    #center{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;text-align:center;z-index:20;pointer-events:none}
    #menu{pointer-events:auto}
    button{background:#00f5ff;color:#000;border:none;border-radius:10px;padding:12px 18px;font-size:16px;cursor:pointer;box-shadow:0 0 20px #00f5ff55;margin:6px}
    #joystick{position:fixed;bottom:40px;left:40px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.08);display:none;z-index:10}
    #stick{position:absolute;inset:35px;border-radius:50%;background:rgba(0,245,255,.8)}
    #soundToggle{position:fixed;top:16px;right:16px;z-index:10}
    #dashBtn{position:fixed;bottom:50px;right:40px;width:90px;height:90px;border-radius:50%;background:rgba(255,0,200,.25);border:2px solid #ff00cc;color:#fff;font-size:14px;font-weight:700;display:none;box-shadow:0 0 25px #ff00cc99;z-index:10}
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<button id="soundToggle">ðŸ”Š</button>
<button id="dashBtn">DASH</button>

<div id="ui">
  <div>Lives: <span id="lives">3</span></div>
  <div id="dashUI"><div id="dashFill"></div></div>
  <div>Score: <span id="score">0</span></div>
  <div>Best: <span id="best">0</span></div>
</div>

<div id="center">
  <div id="menu">
    <h1>NEON DODGE</h1>
    <p>Select a mode</p>
    <button id="endlessBtn">Endless Mode</button>
    <button id="bossBtn">Boss Rush</button>
    <button id="extremeBtn">EXTREME BOSS</button>
  </div>
</div>

<script>
// ===== SETUP =====
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const joystick = document.getElementById('joystick');
const stick = document.getElementById('stick');
const dashBtn = document.getElementById('dashBtn');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const menu = document.getElementById('menu');
const soundToggle = document.getElementById('soundToggle');

let w, h;
function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
addEventListener('resize', resize); resize();

// Show controls on all devices
joystick.style.display = 'block';
dashBtn.style.display = 'block';

// ===== GAME STATE =====
let mode = 'endless';
let bestScore = +localStorage.getItem('neon-best') || 0;
bestEl.textContent = bestScore;

let player, enemies, powerups, boss, score, running, lives;
let dashCD = 0, dashMax = 60, shake = 0;

function reset(){
  lives = 3;
  document.getElementById('lives').textContent = lives;
  player = { x:w/2, y:h/2, r:10, speed:5, shield:0 };
  enemies = [];
  powerups = [];
  boss = null;
  score = 0;
  dashCD = 0;
  shake = 0;
}

function startMode(m){
  dashBtn.style.display = 'block';
  mode = m;
  menu.style.display = 'none';
  function spawnExtremeBoss(){
  boss = {
    x: w/2,
    y: h/2,
    r: 60,
    orbit: 110,
    angle: 0,
    extreme: true,
    orbs: Array.from({length:8},()=>({x:0,y:0,r:12}))
  };
}

reset();
  running = true;

  if(mode==='extremeBoss') spawnExtremeBoss();
}
  // ensure dash button is visible when game starts
  dashBtn.style.display = 'block';
  mode = m;
  menu.style.display = 'none';
  reset();
  running = true;
}

// ===== MENU BUTTONS =====
document.getElementById('endlessBtn').onclick = () => startMode('endless');
document.getElementById('bossBtn').onclick = () => startMode('boss');
document.getElementById('extremeBtn').onclick = () => startMode('extremeBoss'); () => startMode('boss');

// ===== INPUT =====
let keys = {};
addEventListener('keydown', e => keys[e.key] = true);
addEventListener('keyup', e => keys[e.key] = false);

let joyDX = 0, joyDY = 0;
joystick.addEventListener('touchmove', e => {
  e.preventDefault();
  const r = joystick.getBoundingClientRect();
  const t = e.touches[0];
  joyDX = Math.max(-1, Math.min(1, (t.clientX - (r.left + r.width/2)) / 40));
  joyDY = Math.max(-1, Math.min(1, (t.clientY - (r.top + r.height/2)) / 40));
  stick.style.transform = `translate(${joyDX*20}px, ${joyDY*20}px)`;
},{ passive:false });

joystick.addEventListener('touchend', () => {
  joyDX = joyDY = 0;
  stick.style.transform = 'translate(0,0)';
});

// ===== AUDIO =====
let soundOn = true;
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function beep(f,d=.08){
  if(!soundOn) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.frequency.value = f;
  o.start();
  g.gain.exponentialRampToValueAtTime(.0001, audioCtx.currentTime + d);
  o.stop(audioCtx.currentTime + d);
}

soundToggle.onclick = () => {
  soundOn = !soundOn;
  soundToggle.textContent = soundOn ? 'ðŸ”Š' : 'ðŸ”‡';
};

// ===== ACTIONS =====
function dash(){
  if (dashCD > 0) return;
  const dx = joyDX || (keys.ArrowRight||keys.d?1:keys.ArrowLeft||keys.a?-1:0);
  const dy = joyDY || (keys.ArrowDown||keys.s?1:keys.ArrowUp||keys.w?-1:0);
  player.x += dx * 110;
  player.y += dy * 110;
  dashCD = dashMax;
  shake = 12;
  navigator.vibrate?.(80);
  beep(700);
}

dashBtn.addEventListener('touchstart', e => { e.preventDefault(); dash(); }, {passive:false});
dashBtn.addEventListener('mousedown', dash);

// ===== GAME LOOP =====
function spawnEnemy(){
  if(mode==='extremeBoss') return;
  const edge = Math.floor(Math.random()*4);
  let x,y;
  if(edge===0){x=Math.random()*w;y=-20}
  if(edge===1){x=w+20;y=Math.random()*h}
  if(edge===2){x=Math.random()*w;y=h+20}
  if(edge===3){x=-20;y=Math.random()*h}
  const a = Math.atan2(player.y-y, player.x-x);
  enemies.push({x,y,vx:Math.cos(a)*2.6,vy:Math.sin(a)*2.6,r:8});
}

function update(){
  if(!running) return;

  if(boss && boss.extreme){
    boss.angle += 0.03;
    boss.orbs.forEach((o,i)=>{
      const a = boss.angle + (Math.PI*2/boss.orbs.length)*i;
      o.x = boss.x + Math.cos(a)*boss.orbit;
      o.y = boss.y + Math.sin(a)*boss.orbit;
    });
  }
  if(!running) return;

  if(dashCD>0) dashCD--;
  document.getElementById('dashFill').style.width = ((dashMax-dashCD)/dashMax*100)+'%';

  player.x += joyDX * player.speed;
  player.y += joyDY * player.speed;

  if(keys.ArrowUp||keys.w) player.y -= player.speed;
  if(keys.ArrowDown||keys.s) player.y += player.speed;
  if(keys.ArrowLeft||keys.a) player.x -= player.speed;
  if(keys.ArrowRight||keys.d) player.x += player.speed;

  player.x = Math.max(player.r, Math.min(w-player.r, player.x));
  player.y = Math.max(player.r, Math.min(h-player.r, player.y));

  if(score % 50 === 0) spawnEnemy();

  enemies.forEach(e => {
    e.x += e.vx; e.y += e.vy;
    if(Math.hypot(e.x-player.x, e.y-player.y) < e.r + player.r) loseLife()();
  });

  score++;
  scoreEl.textContent = score;
}

function draw(){
  ctx.setTransform(1,0,0,1,(Math.random()-.5)*shake,(Math.random()-.5)*shake);
  ctx.clearRect(-20,-20,w+40,h+40);
  ctx.fillStyle='#000'; ctx.fillRect(0,0,w,h);

  if(boss && boss.extreme){
    ctx.beginPath();
    ctx.arc(boss.x,boss.y,boss.r,0,Math.PI*2);
    ctx.fillStyle='#ff00ff';
    ctx.shadowBlur=30; ctx.shadowColor='#ff00ff';
    ctx.fill(); ctx.shadowBlur=0;

    boss.orbs.forEach(o=>{
      ctx.beginPath();
      ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
      ctx.fillStyle='#ff4444';
      ctx.fill();
    });
  }
  ctx.setTransform(1,0,0,1,(Math.random()-.5)*shake,(Math.random()-.5)*shake);
  ctx.clearRect(-20,-20,w+40,h+40);
  ctx.fillStyle='#000'; ctx.fillRect(0,0,w,h);

  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle='#00f5ff';
  ctx.shadowBlur=20; ctx.shadowColor='#00f5ff';
  ctx.fill(); ctx.shadowBlur=0;

  enemies.forEach(e=>{
    ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fillStyle='#ff0055'; ctx.fill();
  });

  if(shake>0) shake--;
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }

function loseLife(){
  lives--;
  document.getElementById('lives').textContent = lives;
  beep(120,0.3);
  if(lives<=0){ gameOver(); }
}

function gameOver(){
  running = false;
  menu.style.display = 'block';
  if(score > bestScore){
    bestScore = score;
    localStorage.setItem('neon-best', bestScore);
    bestEl.textContent = bestScore;
  }
}

reset();
loop();
</script>
</body>
</html>
