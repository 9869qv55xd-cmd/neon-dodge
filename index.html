<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Neon Dodge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, sans-serif;
      overflow: hidden;
      touch-action: none;
    }
    canvas { display: block; }
    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 14px;
    }
    #center {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    #menu {
      background: rgba(0,0,0,0.8);
      padding: 20px;
      border-radius: 12px;
    }
    button {
      background: #00f5ff;
      border: none;
      padding: 12px 18px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
  Score: <span id="score">0</span><br>
  Best: <span id="best">0</span>
</div>

<div id="center">
  <div id="menu">
    <h1>NEON DODGE</h1>
    <p>Move with keyboard or touch</p>
    <button id="start">Start Game</button>
    <div id="leaderboard"></div>
  </div>
</div>

<!-- ðŸ”¥ FIREBASE LIBRARIES -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* =======================
   ðŸ”¥ FIREBASE CONFIG
   ======================= */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* =======================
   GAME SETUP
   ======================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const menu = document.getElementById("menu");
const startBtn = document.getElementById("start");

let w, h;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

let keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

let touchTarget = null;
canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  touchTarget = { x: t.clientX, y: t.clientY };
});
canvas.addEventListener("touchmove", e => {
  const t = e.touches[0];
  touchTarget = { x: t.clientX, y: t.clientY };
});
canvas.addEventListener("touchend", () => touchTarget = null);

let bestScore = localStorage.getItem("best") || 0;
bestEl.textContent = bestScore;

let player, enemies, score, running;

/* =======================
   LEADERBOARD FUNCTIONS
   ======================= */
function saveScore(name, score) {
  db.collection("leaderboard").add({
    name,
    score,
    created: firebase.firestore.FieldValue.serverTimestamp()
  });
}

async function renderLeaderboard() {
  const snap = await db
    .collection("leaderboard")
    .orderBy("score", "desc")
    .limit(10)
    .get();

  const el = document.getElementById("leaderboard");
  el.innerHTML = "<h3>Leaderboard</h3>" +
    snap.docs.map((d, i) => {
      const s = d.data();
      return `<div>${i + 1}. ${s.name} â€” ${s.score}</div>`;
    }).join("");
}

/* =======================
   GAME LOGIC
   ======================= */
function reset() {
  player = { x: w/2, y: h/2, r: 10, speed: 5 };
  enemies = [];
  score = 0;
}

function spawnEnemy() {
  const edge = Math.floor(Math.random() * 4);
  let x, y;
  if (edge === 0) { x = Math.random()*w; y = -20; }
  if (edge === 1) { x = w+20; y = Math.random()*h; }
  if (edge === 2) { x = Math.random()*w; y = h+20; }
  if (edge === 3) { x = -20; y = Math.random()*h; }

  const a = Math.atan2(player.y - y, player.x - x);
  enemies.push({
    x, y,
    vx: Math.cos(a)*2,
    vy: Math.sin(a)*2,
    r: 8
  });
}

function gameOver() {
  running = false;
  menu.style.display = "block";

  let name = prompt("Enter your name");
  if (!name) name = "Anonymous";

  saveScore(name, score);
  renderLeaderboard();

  if (score > bestScore) {
    bestScore = score;
    localStorage.setItem("best", bestScore);
    bestEl.textContent = bestScore;
  }
}

function update() {
  if (!running) return;

  if (touchTarget) {
    const dx = touchTarget.x - player.x;
    const dy = touchTarget.y - player.y;
    const d = Math.hypot(dx, dy);
    if (d > 1) {
      player.x += dx/d * player.speed;
      player.y += dy/d * player.speed;
    }
  }

  if (keys["ArrowUp"] || keys["w"]) player.y -= player.speed;
  if (keys["ArrowDown"] || keys["s"]) player.y += player.speed;
  if (keys["ArrowLeft"] || keys["a"]) player.x -= player.speed;
  if (keys["ArrowRight"] || keys["d"]) player.x += player.speed;

  player.x = Math.max(player.r, Math.min(w-player.r, player.x));
  player.y = Math.max(player.r, Math.min(h-player.r, player.y));

  enemies.forEach(e => {
    e.x += e.vx;
    e.y += e.vy;
    if (Math.hypot(e.x-player.x, e.y-player.y) < e.r+player.r) {
      gameOver();
    }
  });

  score++;
  scoreEl.textContent = score;
  if (score % 60 === 0) spawnEnemy();
}

function draw() {
  ctx.clearRect(0,0,w,h);

  ctx.fillStyle = "#00f5ff";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#ff0055";
  enemies.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.r, 0, Math.PI*2);
    ctx.fill();
  });
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

startBtn.onclick = () => {
  reset();
  running = true;
  menu.style.display = "none";
};

reset();
loop();
</script>

</body>
</html>
